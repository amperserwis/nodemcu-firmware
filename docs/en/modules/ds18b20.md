# DS18B20 Module
| Since  | Origin / Contributor  | Maintainer  | Source  |
| :----- | :-------------------- | :---------- | :------ |
| 2017-06-11 | [fetchbot](https://github.com/fetchbot) | [fetchbot](https://github.com/fetchbot) | [ds18b20.c](../../../app/modules/ds18b20.c)|

This module provides access to the DS18B20 1-Wire digital thermometer.

## ds18b20.read()
Issues a temperature conversion of all connected sensors on the onewire bus and returns the measurment results after a conversion delay in a callback function.
The callback function gets invoked for every sensor on the bus.

#### Syntax
`ds18b20.read(function(INDEX, ROM0, ROM1, ROM2, ROM3, ROM4, ROM5, ROM6, ROM7, RES, TEMP, TEMP_DEC, PAR) end)`

#### Parameters
none

#### Returns
- `INDEX` index of the sensor on the bus
- `ROM` sensors 64-bit lasered rom code
	* `ROM0` LSB, 8-bit family code
	* `ROM1` - `ROM6` 48-bit serial number
	* `ROM7` MSB 8-bit crc
- `RES` temperature resolution
- `TEMP` temperature
- `TEMP_DEC` temperature decimals for integer firmware
- `PAR` sensor parasitc flag

!!! note

	If using float firmware then `temp` is a floating point number. On an integer firmware, the final value has to be concatenated from `temp` and `temp_dec`.

#### Example
```lua
local ow_pin = 3
ds18b20.setup(ow_pin)

-- read all sensors and print all measurement results
ds18b20.read(
	function(ind,r0,r1,r2,r3,r4,r5,r6,r7,res,temp,tdec,par)
		print(ind,string.format("%02X%02X%02X%02X%02X%02X%02X%02X",r0,r1,r2,r3,r4,r5,r6,r7),res,temp,tdec,par)
	end);

-- print only parasitic sensors
ds18b20.read(
	function(ind,r0,r1,r2,r3,r4,r5,r6,r7,res,temp,tdec,par)
		if (par == 1) then
			print(ind,string.format("%02X%02X%02X%02X%02X%02X%02X%02X",r0,r1,r2,r3,r4,r5,r6,r7),res,temp,tdec,par)
		end
	end);

-- print if temperature is greater or less then a defined value
ds18b20.read(
	function(ind,r0,r1,r2,r3,r4,r5,r6,r7,res,temp,tdec,par)
		if (t > 25) then
			print(ind,string.format("%02X%02X%02X%02X%02X%02X%02X%02X",r0,r1,r2,r3,r4,r5,r6,r7),res,temp,tdec,par)
		end
		if (t < 20) then
			print(ind,string.format("%02X%02X%02X%02X%02X%02X%02X%02X",r0,r1,r2,r3,r4,r5,r6,r7),res,temp,tdec,par)
		end
	end);

-- save device roms in a variable
local addr = {}
ds18b20.read(
	function(ind,r0,r1,r2,r3,r4,r5,r6,r7,res,temp,tdec,par)
		addr[ind] = {r0,r1,r2,r3,r4,r5,r6,r7}
	end);

-- change temperature resolution
for ind,rom in pairs(addr) do
	-- change resolution to 9 bit for device with index 3 and 8
	if (ind == 3 or ind == 8)
		then ds18b20.setting(rom,9)
	end
end
```

## ds18b20.setting()
Configuration of the temperature resolution settings.

#### Syntax
`ds18b20.setting(ROM, RES)`

#### Parameters
- `ROM` Address table of the sensors rom
	* `{0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07}` LSB-MSB
- `RES` temperature resolution
	* `9` - `12`

#### Returns
`nil`

#### Example
```lua
local ow_pin = 3
ds18b20.setup(ow_pin)

ds18b20.setting({0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07}, 9)
```

## ds18b20.setup()
Initializes the onewire bus on the selected pin.

#### Syntax
`ds18b20.setup(OW_BUS_PIN)`

#### Parameters
- `OW_BUS_PIN`
	* `1` - `12`

#### Returns
`nil`

#### Example
```lua
local ow_pin = 3
ds18b20.setup(ow_pin)
```