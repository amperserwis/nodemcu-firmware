# XPT2046 Module
| Since  | Origin / Contributor  | Maintainer  | Source  |
| :----- | :-------------------- | :---------- | :------ |
| 2016-04-14| [Starofall](https://github.com/Starofall) | [Starofall](https://github.com/Starofall) | [xpt2046.c](../../../app/modules/xpt2046.c)|

XPT2046 is a touch controller used by several cheep displays - often in combination with the ILI9341 display controller.
The module is build based on the libarys of [spapadim](https://github.com/spapadim/XPT2046/) and  [PaulStoffregen](https://github.com/PaulStoffregen/XPT2046_Touchscreen).


## xpt2046.setup(cs_pin, irq_pin, height, width)
Setups the XPT2046 module to read touch values from the display. It is required to call spi.setup() before calling xpt2046.setup (see example).
As the ucg lib also requires spi.setup() to be called before it is important to only call it once in total and to activate spi.FULLDUPLEX.
The `clock_div` used in spi.setup() should be 16 or higher, as lower values might produces inaccurate results.

#### Syntax
`xpt2046.setup(cs_pin, irq_pin, height, width)`

#### Parameters
- `cs_pin` GPIO pin for cs
- `irq_pin` GPIO pin for irq
- `height` display height in pixel
- `width` display width in pixel

#### Returns
`nil`

```lua
-- Setup spi with `clock_div` of 16 and spi.FULLDUPLEX
spi.setup(1, spi.MASTER, spi.CPOL_LOW, spi.CPHA_LOW, 8, 16,spi.FULLDUPLEX)
-- SETTING UP DISPLAY (using ucg module)
local disp = ucg.ili9341_18x240x320_hw_spi(8, 4, 0)
disp:begin(0);
-- SETTING UP TOUCH
xpt2046.setup(2,1,320,240)
xpt2046.setCalibration(198, 1776, 1762, 273);
```


## xpt2046.setCalibration(x1, y1, x2, y2)
Sets the configuration of the display. Configuration values can be optained by using xpt2046.getRaw() and read the values in the edges.

#### Syntax
`xpt2046.setCalibration(x1, y1, x2, y2)`

#### Parameters
- `x1` raw x value at top left
- `y1` raw y value at top left
- `x2` raw x value at bottom right
- `y2` raw y value at bottom right

#### Returns
`nil`


## xpt2046.isTouched()
Checks if the touch panel is touched.

#### Syntax
`xpt2046.isTouched()`

#### Returns
true if the display is touched else false

```lua
if(xpt2046.isTouched()) then
	local x, y = xpt2046.getPosition()
	print(x .. "-" .. y)
end
```


## xpt2046.getPosition()
Returns the position the display is touched using the calibration values and given width and height.

#### Syntax
`xpt2046.getPosition()`

#### Returns
returns both the x and the y position.

#### Example
```lua
local x, y = xpt2046.getPosition()
print(x .. "-" .. y)
```


## xpt2046.getPositionMeaned()
To create better measurements this function reads the position three times and averages the two positions with the least distance.

#### Syntax
`xpt2046.getPositionMeaned()`

#### Returns
returns both the x and the y position.

#### Example
```lua
local x, y = xpt2046.getPositionMeaned()
print(x .. "-" .. y)
```


## xpt2046.getRaw()
Reads the raw value from the display. Useful for debugging and custom convertions.

#### Syntax
`xpt2046.getRaw()`

#### Returns
returns both the x and the y position as a raw value.

#### Example
```lua
local rawX, rawY = xpt2046.getRaw()
print(rawX .. "-" .. rawY)
```
