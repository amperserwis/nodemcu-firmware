# ADS1115 Module
| Since  | Origin / Contributor  | Maintainer  | Source  |
| :----- | :-------------------- | :---------- | :------ |
| 2017-04-24 | [fetchbot](https://github.com/fetchbot) | [fetchbot](https://github.com/fetchbot) | [ads1115.c](../../../app/modules/ads1115.c)|

This module provides access to the ADS1115 16-Bit analog-to-digital converter.

!!! note

	The **ABSOLUTE MAXIMUM RATINGS** for all analog inputs are `–0.3V to VDD+0.3V` referred to GND.

## ads1115.setting()
Configure the ADC.

#### Syntax
`ads1115.setting(GAIN, SAMPLES, CHANNEL[, COMPARATOR, THRESHOLD_LOW, THRESHOLD_HI])`

#### Parameters
- `GAIN` Programmable gain amplifier
	* `ads1115.GAIN_6_144V` 2/3x Gain
	* `ads1115.GAIN_4_096V` 1x Gain
	* `ads1115.GAIN_2_048V` 2x Gain
	* `ads1115.GAIN_1_024V` 4x Gain
	* `ads1115.GAIN_0_512V` 8x Gain
	* `ads1115.GAIN_0_256V` 16x Gain
- `SAMPLES` Data rate in samples per second
	* `ads1115.DR_8SPS`
	* `ads1115.DR_16SPS`
	* `ads1115.DR_32SPS`
	* `ads1115.DR_64SPS`
	* `ads1115.DR_128SPS`
	* `ads1115.DR_250SPS`
	* `ads1115.DR_475SPS`
	* `ads1115.DR_860SPS`
- `CHANNEL` Input multiplexer
	* `ads1115.SINGLE_0`
	* `ads1115.SINGLE_1`
	* `ads1115.SINGLE_2`
	* `ads1115.SINGLE_3`
	* `ads1115.DIFF_0_1`
	* `ads1115.DIFF_0_3`
	* `ads1115.DIFF_1_3`
	* `ads1115.DIFF_2_3`
- `COMPARATOR` Number of conversions after comparator asserts
	* `ads1115.COMP_1CONV`
	* `ads1115.COMP_2CONV`
	* `ads1115.COMP_4CONV`
- `THRESHOLD_LOW`
	* `0` - `+ GAIN_MAX` in mV for single-ended inputs
	* `- GAIN_MAX` - `+ GAIN_MAX` in mV for differential inputs
- `THRESHOLD_HI`
	* `0` - `+ GAIN_MAX` in mV for single-ended inputs
	* `- GAIN_MAX` - `+ GAIN_MAX` in mV for differential inputs

#### Returns
`nil`

#### Example
```lua
local id, alert, sda, scl = 0, 7, 6, 5
i2c.setup(id, sda, scl, i2c.SLOW) -- call i2c.setup() only once
ads1115.setup(ads1115.ADDR_GND)

ads1115.setting(ads1115.GAIN_6_144V, ads1115.DR_128SPS, ads1115.SINGLE_0, ads1115.COMP_1CONV, 1000, 2000)
```

## ads1115.setup()
Initializes the device on the defined I²C device address.

#### Syntax
`ads1115.setup(ADDRESS)`

#### Parameters
- `ADDRESS`
	* `ads1115.ADDR_GND`
	* `ads1115.ADDR_VDD`
	* `ads1115.ADDR_SDA`
	* `ads1115.ADDR_SCL`

#### Returns
`nil`

#### Example
```lua
local id, sda, scl = 6, 5
i2c.setup(id, sda, scl, i2c.SLOW) -- call i2c.setup() only once

ads1115.setup(ads1115.ADDR_GND)
```

## ads1115.read()

#### Syntax
`ads1115.read()`

#### Parameters
none

#### Returns
- `volt` voltage in mV (see note below)
- `volt_dec` voltage decimal (see note below)
- `adc` raw adc value

!!! note

	If using float firmware then `volt` is a floating point number. On an integer firmware, the final value has to be concatenated from `volt` and `volt_dec`.

#### Example
```lua
local id, sda, scl = 0, 6, 5
i2c.setup(id, sda, scl, i2c.SLOW) -- call i2c.setup() only once
ads1115.setup(ads1115.ADDR_GND)
ads1115.setting(ads1115.GAIN_6_144V, ads1115.DR_128SPS, ads1115.SINGLE_0)

volt, volt_dec, adc = ads1115.read()

-- Integer firmware using this example
print(string.format("Voltage:\t%d.%03d mV\nADC:\t\t%d", volt, volt_dec, adc))

-- Float firmware using this example
print("Voltage:\t"..volt.."\n".."ADC:\t\t"..adc)
```

```lua
local id, alert_pin, sda, scl = 0, 7, 6, 5
i2c.setup(id, sda, scl, i2c.SLOW) -- call i2c.setup() only once

local function alert(level, when)
	volt, volt_dec, adc = ads1115.read()
	print("Voltage:\t"..volt.."\t".."ADC:\t\t"..adc)
	if level == 1 then
		print("Voltage under THRESHOLD_LOW (1000mV)")
	else
		print("Voltage over THRESHOLD_HI (2000mV)")
	end
end

gpio.mode(alert_pin, gpio.INT)
gpio.trig(alert_pin, "both", alert)

ads1115.setup(ads1115.ADDR_GND)
ads1115.setting(ads1115.GAIN_6_144V, ads1115.DR_128SPS, ads1115.SINGLE_0, ads1115.COMP_1CONV, 1000, 2000)
```
